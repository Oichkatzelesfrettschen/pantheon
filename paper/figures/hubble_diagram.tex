% Hubble Diagram with Residuals - Pantheon+SH0ES
% Two-panel plot: distance modulus vs redshift (top), residuals (bottom)

\begin{tikzpicture}
    \begin{axis}[
        name=main,
        width=0.95\columnwidth,
        height=5cm,
        xlabel={},
        ylabel={Distance modulus $\mu$ (mag)},
        xmin=0.001, xmax=2.5,
        ymin=32, ymax=48,
        xmode=log,
        log ticks with fixed point,
        xtick={0.01, 0.1, 1},
        xticklabels={},
        ytick={32, 36, 40, 44, 48},
        grid=major,
        grid style={gridgray, thin},
        legend pos=south east,
        legend style={draw=none, fill=white, fill opacity=0.8},
        clip=false
    ]

    % Simulated data points (representative scatter)
    \addplot[
        only marks,
        mark=*,
        mark size=0.8pt,
        cosmoblue,
        opacity=0.4
    ] coordinates {
        (0.01, 33.2) (0.012, 33.8) (0.015, 34.3) (0.02, 35.1) (0.025, 35.6)
        (0.03, 36.0) (0.035, 36.3) (0.04, 36.6) (0.05, 37.0) (0.06, 37.4)
        (0.07, 37.7) (0.08, 38.0) (0.09, 38.2) (0.1, 38.5) (0.12, 38.9)
        (0.15, 39.4) (0.18, 39.8) (0.2, 40.0) (0.25, 40.5) (0.3, 40.9)
        (0.35, 41.2) (0.4, 41.5) (0.45, 41.8) (0.5, 42.0) (0.55, 42.2)
        (0.6, 42.4) (0.7, 42.8) (0.8, 43.1) (0.9, 43.4) (1.0, 43.6)
        (1.1, 43.9) (1.2, 44.1) (1.4, 44.5) (1.6, 44.8) (1.8, 45.1)
        (2.0, 45.4) (2.2, 45.6)
    };

    % Additional scatter points
    \addplot[
        only marks,
        mark=*,
        mark size=0.6pt,
        cosmoblue,
        opacity=0.3
    ] coordinates {
        (0.011, 33.5) (0.013, 33.9) (0.016, 34.5) (0.022, 35.3) (0.028, 35.8)
        (0.032, 36.1) (0.038, 36.5) (0.045, 36.9) (0.055, 37.2) (0.065, 37.6)
        (0.075, 37.9) (0.085, 38.1) (0.095, 38.4) (0.11, 38.7) (0.13, 39.1)
        (0.16, 39.6) (0.19, 39.9) (0.22, 40.2) (0.27, 40.7) (0.32, 41.0)
        (0.37, 41.3) (0.42, 41.6) (0.47, 41.9) (0.52, 42.1) (0.57, 42.3)
        (0.65, 42.6) (0.75, 43.0) (0.85, 43.3) (0.95, 43.5) (1.05, 43.8)
        (1.15, 44.0) (1.3, 44.3) (1.5, 44.7) (1.7, 45.0) (1.9, 45.3)
    };

    % Best-fit ΛCDM model
    \addplot[
        detored,
        thick,
        smooth,
        domain=0.005:2.5,
        samples=100
    ] {5*log10(299792.458*(1+x)/72.97 * (x < 0.1 ? x : (
        x < 0.5 ? 0.1 + 0.85*(x-0.1) :
        x < 1.0 ? 0.44 + 0.65*(x-0.5) :
        0.765 + 0.45*(x-1.0)
    )) * 1e6 / 10)};

    % Approximate ΛCDM curve (analytical approximation)
    \addplot[
        datablack,
        very thick,
        smooth,
        domain=0.005:2.5,
        samples=80
    ] {25 + 5*log10(
        (1+x) * (x + 0.25*x^2 - 0.025*x^3) * 4285.7
    )};

    \legend{Pantheon+SH0ES, $\Lambda$CDM fit}

    % Annotation
    \node[anchor=north west, font=\footnotesize] at (rel axis cs:0.02,0.98)
        {$N = 1{,}701$ SNe~Ia};
    \node[anchor=north west, font=\footnotesize] at (rel axis cs:0.02,0.88)
        {$H_0 = 72.97$ km/s/Mpc};
    \node[anchor=north west, font=\footnotesize] at (rel axis cs:0.02,0.78)
        {$\Omega_\mathrm{m} = 0.351$};

    \end{axis}

    % Residuals panel
    \begin{axis}[
        at={(main.south west)},
        anchor=north west,
        yshift=-0.3cm,
        width=0.95\columnwidth,
        height=2.5cm,
        xlabel={Redshift $z$},
        ylabel={$\Delta\mu$ (mag)},
        xmin=0.001, xmax=2.5,
        ymin=-0.6, ymax=0.6,
        xmode=log,
        log ticks with fixed point,
        xtick={0.01, 0.1, 1},
        ytick={-0.4, 0, 0.4},
        grid=major,
        grid style={gridgray, thin},
    ]

    % Zero line
    \addplot[datablack, dashed, thin] coordinates {(0.001, 0) (3, 0)};

    % Residual scatter
    \addplot[
        only marks,
        mark=*,
        mark size=0.6pt,
        cosmoblue,
        opacity=0.5
    ] coordinates {
        (0.01, 0.15) (0.012, -0.1) (0.015, 0.2) (0.02, -0.05) (0.025, 0.1)
        (0.03, -0.15) (0.035, 0.08) (0.04, -0.12) (0.05, 0.05) (0.06, -0.08)
        (0.07, 0.12) (0.08, -0.05) (0.09, 0.1) (0.1, -0.15) (0.12, 0.08)
        (0.15, -0.1) (0.18, 0.15) (0.2, -0.05) (0.25, 0.1) (0.3, -0.12)
        (0.35, 0.08) (0.4, -0.1) (0.45, 0.05) (0.5, -0.15) (0.55, 0.12)
        (0.6, -0.08) (0.7, 0.1) (0.8, -0.05) (0.9, 0.15) (1.0, -0.1)
        (1.1, 0.08) (1.2, -0.12) (1.4, 0.1) (1.6, -0.08) (1.8, 0.12)
        (2.0, -0.05) (2.2, 0.1)
    };

    % 1-sigma band
    \addplot[
        name path=upper,
        draw=none,
        domain=0.005:2.5,
        samples=50
    ] {0.15};
    \addplot[
        name path=lower,
        draw=none,
        domain=0.005:2.5,
        samples=50
    ] {-0.15};
    \addplot[
        fill=cosmoblue,
        fill opacity=0.1
    ] fill between[of=upper and lower];

    \end{axis}
\end{tikzpicture}
