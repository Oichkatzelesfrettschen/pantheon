% Kolmogorov Turbulent Cascade
% Shows energy spectrum and fractal flame structure

\begin{tikzpicture}[
    every node/.style={font=\small}
]

    % Energy spectrum plot
    \begin{loglogaxis}[
        name=spectrum,
        width=0.55\columnwidth,
        height=5cm,
        xlabel={Wavenumber $k$},
        ylabel={Energy $E(k)$},
        xmin=0.1, xmax=1000,
        ymin=1e-6, ymax=10,
        grid=major,
        grid style={gridgray, thin},
        xtick={0.1, 1, 10, 100, 1000},
        xticklabels={$L^{-1}$, , , , $\lambda_k^{-1}$},
    ]

    % Kolmogorov -5/3 spectrum
    \addplot[
        cosmoblue,
        very thick,
        smooth,
        domain=0.3:300,
        samples=50
    ] {2 * x^(-5/3)};

    % Energy injection range
    \addplot[
        astrogreen,
        thick,
        domain=0.1:0.5,
        samples=20
    ] {1.5 * exp(-((ln(x) - ln(0.3))^2)/0.5)};

    % Dissipation range
    \addplot[
        detored,
        thick,
        domain=200:1000,
        samples=20
    ] {2 * 200^(-5/3) * exp(-(x-200)/200)};

    % Inertial range annotation
    \draw[{Stealth[length=2mm]}-{Stealth[length=2mm]}, thick, nucpurple]
        (axis cs:1, 0.5) -- (axis cs:100, 0.5)
        node[midway, above, font=\footnotesize] {Inertial range};

    % Slope annotation
    \node[cosmoblue, font=\footnotesize, rotate=-35] at (axis cs:10, 0.03) {$k^{-5/3}$};

    % Energy injection label
    \node[astrogreen, font=\tiny, anchor=south] at (axis cs:0.3, 2) {injection};

    % Dissipation label
    \node[detored, font=\tiny, anchor=west] at (axis cs:500, 1e-5) {dissipation};

    \end{loglogaxis}

    % Fractal flame illustration
    \begin{scope}[shift={(6.5cm, 0)}]

        % Background
        \fill[white] (-0.5,-0.5) rectangle (3.5,4.5);

        % Title
        \node[font=\footnotesize\bfseries, anchor=south] at (1.5, 4.2) {Fractal Flame};

        % Fractal flame shape (Koch-like curve approximation)
        \draw[detored, very thick, fill=flameorange, fill opacity=0.3]
            (0,0) -- (0.2,0.5) -- (0.1,1) -- (0.4,1.3) -- (0.2,1.8)
            -- (0.5,2.2) -- (0.3,2.6) -- (0.6,3) -- (0.4,3.4) -- (0.8,3.8)
            -- (1.2,3.6) -- (1.5,4) -- (1.8,3.6) -- (2.2,3.8)
            -- (2.0,3.4) -- (2.4,3) -- (2.1,2.6) -- (2.5,2.2)
            -- (2.2,1.8) -- (2.6,1.3) -- (2.3,1) -- (2.5,0.5) -- (2.8,0)
            -- cycle;

        % Unburned region label
        \node[font=\tiny, cosmoblue] at (0.5, 2) {Unburned};
        \node[font=\tiny, cosmoblue] at (0.5, 1.7) {(fuel)};

        % Burned region label
        \node[font=\tiny, detored] at (2.3, 2) {Burned};
        \node[font=\tiny, detored] at (2.3, 1.7) {(ash)};

        % Fractal dimension annotation
        \node[
            draw=datablack,
            fill=white,
            inner sep=3pt,
            font=\tiny,
            anchor=north west
        ] at (-0.3, -0.1) {
            $D \approx 2.3$--$2.7$
        };

        % Scale indicators
        \draw[|-|, thick] (3.2, 0) -- (3.2, 1)
            node[midway, right, font=\tiny] {$\lambda_k$};
        \draw[|-|, thick] (3.2, 1.5) -- (3.2, 4)
            node[midway, right, font=\tiny] {$L$};

        % Wrinkling arrows
        \draw[-{Stealth[length=1.5mm]}, gray, thick]
            (-0.3, 3) -- (0.3, 2.8);
        \draw[-{Stealth[length=1.5mm]}, gray, thick]
            (3.1, 3) -- (2.5, 2.8);
        \node[gray, font=\tiny, anchor=east] at (-0.3, 3.2) {RT};
        \node[gray, font=\tiny, anchor=west] at (3.1, 3.2) {RT};

    \end{scope}

    % Connection arrow
    \draw[-{Stealth[length=2mm]}, thick, gray, dashed]
        ([xshift=0.5cm]spectrum.east) -- ([xshift=-0.3cm]4.8,2)
        node[midway, above, font=\tiny, sloped] {drives wrinkling};

    % Equation box
    \node[
        draw=datablack,
        fill=white,
        inner sep=4pt,
        font=\footnotesize,
        anchor=north,
        align=center
    ] at (3.3, -0.8) {
        Turbulent flame speed:\\[2pt]
        $S_T = S_L \left(\dfrac{L}{\lambda_k}\right)^{D-2}$
    };

\end{tikzpicture}
