% DDT Time Evolution - Four-panel figure
% Shows density, velocity, temperature, and composition profiles at different times

\begin{tikzpicture}
    \pgfplotsset{
        evolution plot/.style={
            width=0.24\textwidth,
            height=4cm,
            xlabel={$x$ (km)},
            xmin=0, xmax=500,
            grid=major,
            grid style={gridgray, very thin},
            legend style={
                at={(0.98,0.98)},
                anchor=north east,
                draw=none,
                fill=white,
                fill opacity=0.8,
                font=\tiny,
                row sep=-2pt
            },
            cycle list={
                {cosmoblue, thick},
                {astrogreen, thick},
                {flameorange, thick},
                {detored, thick}
            }
        }
    }

    % Panel 1: Density
    \begin{axis}[
        evolution plot,
        name=density,
        ylabel={$\rho$ ($10^7$ g/cm$^3$)},
        ymin=0, ymax=5,
        title={\footnotesize Density},
    ]

    % t = 0 ms
    \addplot[cosmoblue, thick] coordinates {
        (0,2) (100,2) (200,2) (300,2) (400,2) (500,2)
    };

    % t = 0.3 ms
    \addplot[astrogreen, thick, smooth] coordinates {
        (0,2.2) (50,2.3) (100,2.8) (150,3.5) (200,2.5) (250,2) (300,2) (400,2) (500,2)
    };

    % t = 0.6 ms
    \addplot[flameorange, thick, smooth] coordinates {
        (0,2.5) (50,2.8) (100,3.2) (150,4.2) (200,4.5) (250,3.0) (300,2.2) (350,2) (450,2) (500,2)
    };

    % t = 0.76 ms
    \addplot[detored, thick, smooth] coordinates {
        (0,2.8) (50,3.0) (100,3.5) (150,4.0) (200,4.8) (250,4.5) (300,3.8) (350,2.5) (400,2.1) (500,2)
    };

    \legend{$t=0$, $0.3$, $0.6$, $0.76$ ms}
    \end{axis}

    % Panel 2: Velocity
    \begin{axis}[
        evolution plot,
        at={(density.east)},
        anchor=west,
        xshift=0.5cm,
        name=velocity,
        ylabel={$u$ ($10^8$ cm/s)},
        ymin=-1, ymax=6,
        title={\footnotesize Velocity},
    ]

    % t = 0 ms
    \addplot[cosmoblue, thick] coordinates {
        (0,0) (500,0)
    };

    % t = 0.3 ms
    \addplot[astrogreen, thick, smooth] coordinates {
        (0,0) (50,0.2) (100,1.0) (150,2.0) (200,1.5) (250,0.5) (300,0.1) (400,0) (500,0)
    };

    % t = 0.6 ms
    \addplot[flameorange, thick, smooth] coordinates {
        (0,0) (50,0.5) (100,1.5) (150,3.0) (200,4.0) (250,3.5) (300,2.0) (350,0.5) (450,0) (500,0)
    };

    % t = 0.76 ms (detonation)
    \addplot[detored, thick, smooth] coordinates {
        (0,0) (50,0.8) (100,2.0) (150,3.5) (200,5.0) (250,5.4) (300,5.2) (350,4.0) (400,1.5) (500,0)
    };

    \end{axis}

    % Panel 3: Temperature
    \begin{axis}[
        evolution plot,
        at={(velocity.east)},
        anchor=west,
        xshift=0.5cm,
        name=temperature,
        ylabel={$T$ ($10^9$ K)},
        ymin=0, ymax=6,
        title={\footnotesize Temperature},
    ]

    % t = 0 ms (initial hot spot)
    \addplot[cosmoblue, thick, smooth] coordinates {
        (0,0.5) (50,0.8) (100,1.5) (150,2.0) (200,1.0) (250,0.3) (300,0.1) (400,0.1) (500,0.1)
    };

    % t = 0.3 ms
    \addplot[astrogreen, thick, smooth] coordinates {
        (0,1.0) (50,1.5) (100,2.5) (150,3.5) (200,2.5) (250,1.0) (300,0.3) (400,0.1) (500,0.1)
    };

    % t = 0.6 ms
    \addplot[flameorange, thick, smooth] coordinates {
        (0,1.5) (50,2.0) (100,3.0) (150,4.2) (200,4.8) (250,3.5) (300,1.5) (350,0.5) (450,0.1) (500,0.1)
    };

    % t = 0.76 ms (peak)
    \addplot[detored, thick, smooth] coordinates {
        (0,2.0) (50,2.5) (100,3.5) (150,4.5) (200,5.2) (250,5.5) (300,4.8) (350,3.0) (400,1.0) (500,0.1)
    };

    % NSE threshold
    \addplot[datablack, dashed, thin] coordinates {(0,5) (500,5)};
    \node[font=\tiny, anchor=west] at (axis cs:10, 5.3) {NSE};

    \end{axis}

    % Panel 4: C12 mass fraction
    \begin{axis}[
        evolution plot,
        at={(temperature.east)},
        anchor=west,
        xshift=0.5cm,
        name=composition,
        ylabel={$Y_\mathrm{C12}$},
        ymin=0, ymax=1.1,
        title={\footnotesize C$^{12}$ Fraction},
    ]

    % t = 0 ms
    \addplot[cosmoblue, thick] coordinates {
        (0,0.5) (500,0.5)
    };

    % t = 0.3 ms
    \addplot[astrogreen, thick, smooth] coordinates {
        (0,0.1) (50,0.15) (100,0.25) (150,0.35) (200,0.45) (250,0.5) (300,0.5) (400,0.5) (500,0.5)
    };

    % t = 0.6 ms
    \addplot[flameorange, thick, smooth] coordinates {
        (0,0.02) (50,0.05) (100,0.1) (150,0.15) (200,0.2) (250,0.35) (300,0.48) (350,0.5) (450,0.5) (500,0.5)
    };

    % t = 0.76 ms
    \addplot[detored, thick, smooth] coordinates {
        (0,0) (50,0.01) (100,0.02) (150,0.03) (200,0.05) (250,0.1) (300,0.25) (350,0.45) (400,0.5) (500,0.5)
    };

    % Ash region label
    \fill[detored, opacity=0.1] (axis cs:0,0) rectangle (axis cs:200,0.1);
    \node[font=\tiny, detored] at (axis cs:100, 0.05) {Ash};

    \end{axis}

    % Time arrow below
    \draw[-{Stealth[length=3mm]}, very thick, gray]
        ([yshift=-1cm]density.south west) -- ([yshift=-1cm]composition.south east)
        node[midway, below, font=\small] {Time $\longrightarrow$};

    % DDT marker
    \node[
        draw=nucpurple,
        thick,
        fill=white,
        inner sep=2pt,
        font=\tiny,
        anchor=north
    ] at ([yshift=-0.3cm]temperature.south) {DDT at $t \approx 0.5$ ms};

\end{tikzpicture}
